<!--
	https://bl.ocks.org/mbostock/4060366

	https://codereview.stackexchange.com/questions/123554/converting-an-svg-polygon-path-from-relative-to-absolute-coordinates
-->

<!DOCTYPE html>

<html lang="zh-Hant-TW">

<head>
	<meta charset="utf-8">
	<title>voronoi</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<style>
		.links {
		  stroke: #000;
		  stroke-opacity: 0.2;
		}

		.polygons {
		  fill: none;
		  stroke: #000;
		}

		.polygons :first-child {
		  fill: #f00;
		}

		.sites {
		  fill: #000;
		  stroke: #fff;
		}

		.sites :first-child {
		  fill: #fff;
		}

		svg {
			border: 1px solid black;
		}
	</style>
</head>

<body>
	<svg id="svgvoronoi" width="960" height="600" transform="scale(1,-1)"></svg>

	<script>
	var svg = d3.select("#svgvoronoi").on("touchmove mousemove", moved),
	    width = +svg.attr("width"),
	    height = +svg.attr("height");

	var sites = 
[[508,487],[503,470],[532,476],[508,487],[501,474],[503,470],[508,487],[500,477],[501,474],[508,487],[499,480],[500,477],[508,487],[497,483],[499,480],[508,487],[495,485],[497,483],[508,487],[495,493],[495,485],[532,476],[546,464],[542,471],[532,476],[546,461],[546,464],[532,476],[547,458],[546,461],[532,476],[507,450],[547,458],[532,476],[505,460],[507,450],[532,476],[504,466],[505,460],[532,476],[503,470],[504,466],[542,471],[544,467],[543,470],[542,471],[546,464],[544,467],[547,458],[507,450],[547,453],[547,453],[507,450],[547,449],[547,449],[507,450],[547,444],[547,444],[509,439],[547,441],[547,444],[507,450],[509,439],[547,441],[509,439],[546,432],[546,432],[510,426],[543,413],[546,432],[509,439],[510,426],[543,413],[511,405],[542,395],[543,413],[510,419],[511,405],[543,413],[510,426],[510,419],[542,395],[513,380],[540,377],[542,395],[511,405],[513,380],[540,377],[513,380],[539,367],[539,367],[514,360],[539,343],[539,367],[513,380],[514,360],[539,343],[556,333],[558,346],[539,343],[539,330],[556,333],[539,343],[515,338],[539,330],[539,343],[515,344],[515,338],[539,343],[514,360],[515,344],[558,346],[585,339],[593,353],[558,346],[556,333],[585,339],[593,353],[610,343],[625,358],[593,353],[585,339],[610,343],[625,358],[640,348],[654,363],[625,358],[631,346],[640,348],[625,358],[610,343],[631,346],[654,363],[672,348],[667,365],[654,363],[640,348],[672,348],[667,365],[680,380],[667,367],[667,365],[681,347],[680,380],[667,365],[675,348],[681,347],[667,365],[672,348],[675,348],[667,367],[680,380],[668,370],[668,370],[678,380],[668,373],[668,370],[680,380],[678,380],[668,373],[675,379],[670,375],[668,373],[678,380],[675,379],[670,375],[673,378],[671,377],[670,375],[675,379],[673,378],[680,380],[681,347],[682,380],[682,380],[681,347],[687,381],[687,381],[688,346],[692,381],[687,381],[681,347],[688,346],[692,381],[688,346],[697,380],[697,380],[704,377],[699,380],[697,380],[688,346],[704,377],[704,377],[697,343],[715,371],[704,377],[694,344],[697,343],[704,377],[688,346],[694,344],[715,371],[708,337],[727,365],[715,371],[700,341],[708,337],[715,371],[697,343],[700,341],[727,365],[722,330],[739,360],[727,365],[715,333],[722,330],[727,365],[708,337],[715,333],[739,360],[729,328],[746,357],[739,360],[722,330],[729,328],[746,357],[736,326],[752,354],[746,357],[729,328],[736,326],[752,354],[750,323],[762,348],[752,354],[743,324],[750,323],[752,354],[736,326],[743,324],[762,348],[767,336],[766,345],[762,348],[766,334],[767,336],[762,348],[766,333],[766,334],[762,348],[750,323],[766,333],[766,345],[768,337],[766,345],[766,345],[767,336],[768,337],[766,345],[768,339],[767,343],[766,345],[768,337],[768,339],[767,343],[768,340],[768,342],[767,343],[768,339],[768,340],[766,333],[753,323],[765,332],[766,333],[750,323],[753,323],[765,332],[754,323],[764,330],[765,332],[753,323],[754,323],[764,330],[757,323],[763,328],[764,330],[754,323],[757,323],[763,328],[759,324],[762,326],[763,328],[757,323],[759,324],[762,326],[759,324],[760,325],[539,330],[515,326],[539,327],[539,330],[515,338],[515,326],[539,327],[515,326],[538,321],[538,321],[515,314],[537,315],[538,321],[515,326],[515,314],[537,315],[515,314],[537,309],[537,309],[515,314],[537,306],[537,306],[514,293],[535,283],[537,306],[515,314],[514,293],[535,283],[514,273],[531,249],[535,283],[514,293],[514,273],[531,249],[511,241],[529,235],[531,249],[513,256],[511,241],[531,249],[514,273],[513,256],[529,235],[511,241],[529,230],[529,230],[509,227],[529,226],[529,230],[511,241],[509,227],[529,226],[509,227],[529,222],[529,222],[507,219],[529,218],[529,222],[509,227],[507,219],[529,218],[507,219],[530,215],[530,215],[506,213],[531,212],[530,215],[507,219],[506,213],[531,212],[505,209],[532,209],[531,212],[506,213],[505,209],[532,209],[505,209],[532,208],[532,208],[536,186],[539,208],[532,208],[526,185],[536,186],[532,208],[517,183],[526,185],[532,208],[503,205],[517,183],[532,208],[505,209],[503,205],[539,208],[546,188],[553,209],[539,208],[536,186],[546,188],[553,209],[557,189],[568,210],[553,209],[546,188],[557,189],[568,210],[578,190],[583,210],[568,210],[567,190],[578,190],[568,210],[557,189],[567,190],[583,210],[589,190],[591,210],[583,210],[584,190],[589,190],[583,210],[578,190],[584,190],[591,210],[597,220],[591,211],[591,210],[599,221],[597,220],[591,210],[602,222],[599,221],[591,210],[603,222],[602,222],[591,210],[609,188],[603,222],[591,210],[600,190],[609,188],[591,210],[589,190],[600,190],[591,211],[595,219],[592,213],[591,211],[597,220],[595,219],[592,213],[593,217],[592,215],[592,213],[595,219],[593,217],[603,222],[609,188],[605,223],[605,223],[609,188],[609,225],[609,225],[609,188],[613,225],[613,225],[630,220],[617,226],[613,225],[609,188],[630,220],[617,226],[630,220],[620,226],[620,226],[628,222],[622,225],[620,226],[630,220],[628,222],[622,225],[628,222],[625,225],[625,225],[628,222],[627,223],[630,220],[616,187],[633,217],[630,220],[609,188],[616,187],[633,217],[621,186],[637,214],[633,217],[616,187],[621,186],[637,214],[625,185],[641,211],[637,214],[621,186],[625,185],[641,211],[629,183],[646,208],[641,211],[625,185],[629,183],[646,208],[637,180],[651,205],[646,208],[633,182],[637,180],[646,208],[629,183],[633,182],[651,205],[641,178],[656,203],[651,205],[637,180],[641,178],[656,203],[644,176],[662,201],[656,203],[641,178],[644,176],[662,201],[651,172],[665,200],[662,201],[648,174],[651,172],[662,201],[644,176],[648,174],[665,200],[651,172],[668,198],[668,198],[656,169],[676,194],[668,198],[651,172],[656,169],[676,194],[663,166],[683,189],[676,194],[656,169],[663,166],[683,189],[675,162],[691,183],[683,189],[669,163],[675,162],[683,189],[663,166],[669,163],[691,183],[695,178],[694,180],[691,183],[695,175],[695,178],[691,183],[695,171],[695,175],[691,183],[684,161],[695,171],[691,183],[677,161],[684,161],[691,183],[675,162],[677,161],[694,180],[695,179],[695,180],[694,180],[695,178],[695,179],[695,171],[694,167],[694,168],[695,171],[684,161],[694,167],[694,167],[684,161],[692,165],[692,165],[684,161],[691,163],[691,163],[684,161],[690,162],[690,162],[684,161],[689,161],[689,161],[684,161],[688,160],[688,160],[685,161],[686,160],[688,160],[684,161],[685,161],[656,169],[651,172],[653,171],[517,183],[503,203],[507,180],[517,183],[503,205],[503,203],[507,180],[493,198],[498,178],[507,180],[500,201],[493,198],[507,180],[503,203],[500,201],[498,178],[487,196],[489,175],[498,178],[493,198],[487,196],[489,175],[476,192],[480,172],[489,175],[482,194],[476,192],[489,175],[487,196],[482,194],[480,172],[470,190],[472,169],[480,172],[476,192],[470,190],[472,169],[459,188],[463,165],[472,169],[464,189],[459,188],[472,169],[470,190],[464,189],[463,165],[456,188],[455,162],[463,165],[459,188],[456,188],[455,162],[446,188],[448,158],[455,162],[456,188],[446,188],[448,158],[426,180],[440,153],[448,158],[432,184],[426,180],[448,158],[446,188],[432,184],[440,153],[418,168],[436,151],[440,153],[424,178],[418,168],[440,153],[426,180],[424,178],[436,151],[417,163],[434,150],[436,151],[418,168],[417,163],[434,150],[417,163],[431,149],[431,149],[417,163],[428,148],[428,148],[415,158],[425,147],[428,148],[417,163],[415,158],[425,147],[415,158],[422,147],[422,147],[415,158],[419,148],[419,148],[415,158],[417,149],[417,149],[414,156],[415,150],[417,149],[415,158],[414,156],[415,150],[414,156],[414,151],[414,151],[414,155],[414,152],[414,151],[414,156],[414,155],[414,152],[413,154],[413,153],[414,152],[414,155],[413,154],[418,168],[424,178],[419,173],[419,173],[424,178],[419,176],[432,184],[446,188],[436,188],[436,188],[446,188],[437,188],[437,188],[442,189],[440,189],[437,188],[445,188],[442,189],[437,188],[446,188],[445,188],[515,326],[515,338],[505,323],[505,323],[498,334],[477,315],[505,323],[515,338],[498,334],[477,315],[461,325],[458,311],[477,315],[498,334],[461,325],[458,311],[461,325],[418,301],[418,301],[394,309],[347,284],[418,301],[461,325],[394,309],[347,284],[335,294],[316,276],[347,284],[343,296],[335,294],[347,284],[394,309],[343,296],[316,276],[309,288],[314,275],[316,276],[320,290],[309,288],[316,276],[335,294],[320,290],[314,275],[309,288],[310,274],[310,274],[303,287],[306,273],[310,274],[309,288],[303,287],[306,273],[303,287],[302,272],[302,272],[297,286],[298,271],[302,272],[303,287],[297,286],[298,271],[297,286],[294,271],[294,271],[291,285],[291,271],[294,271],[297,286],[291,285],[291,271],[291,285],[287,272],[287,272],[286,285],[283,272],[287,272],[291,285],[286,285],[283,272],[281,285],[280,274],[283,272],[286,285],[281,285],[280,274],[281,285],[276,275],[276,275],[277,285],[272,277],[276,275],[281,285],[277,285],[272,277],[273,286],[269,279],[272,277],[277,285],[273,286],[269,279],[269,286],[265,281],[269,279],[273,286],[269,286],[265,281],[266,287],[262,284],[265,281],[269,286],[266,287],[262,284],[263,289],[259,287],[262,284],[266,287],[263,289],[259,287],[260,290],[257,289],[259,287],[263,289],[260,290],[257,289],[258,292],[256,290],[257,289],[259,291],[258,292],[257,289],[260,290],[259,291],[256,290],[257,292],[256,291],[256,290],[258,292],[257,292],[256,291],[256,292],[256,292],[256,291],[257,292],[256,292],[495,485],[495,493],[494,487],[494,487],[495,493],[493,488],[493,488],[494,493],[492,488],[493,488],[495,493],[494,493],[492,488],[492,492],[491,489],[492,488],[494,493],[492,492],[491,489],[491,492],[490,490],[491,489],[492,492],[491,492],[490,490],[490,492],[490,491],[490,490],[491,492],[490,492]]
;

	var voronoi = d3.voronoi()
	    .extent([[-1, -1], [width + 1, height + 1]]);

	var polygon = svg.append("g")
	    .attr("class", "polygons")
	  .selectAll("path")
	  .data(voronoi.polygons(sites))
	  .enter().append("path")
	    .call(redrawPolygon);

	var link = svg.append("g")
	    .attr("class", "links")
	  .selectAll("line")
	  .data(voronoi.links(sites))
	  .enter().append("line")
	    .call(redrawLink);

	var site = svg.append("g")
	    .attr("class", "sites")
	  .selectAll("circle")
	  .data(sites)
	  .enter().append("circle")
	    .attr("r", 2.5)
	    .call(redrawSite);

	function moved() {
	  sites[0] = d3.mouse(this);
	  redraw();
	}

	function redraw() {
	  var diagram = voronoi(sites);
	  polygon = polygon.data(diagram.polygons()).call(redrawPolygon);
	  link = link.data(diagram.links()), link.exit().remove();
	  link = link.enter().append("line").merge(link).call(redrawLink);
	  site = site.data(sites).call(redrawSite);
	}

	function redrawPolygon(polygon) {
	  polygon
	      .attr("d", function(d) { return d ? "M" + d.join("L") + "Z" : null; });
	}

	function redrawLink(link) {
	  link
	      .attr("x1", function(d) { return d.source[0]; })
	      .attr("y1", function(d) { return d.source[1]; })
	      .attr("x2", function(d) { return d.target[0]; })
	      .attr("y2", function(d) { return d.target[1]; });
	}

	function redrawSite(site) {
	  site
	      .attr("cx", function(d) { return d[0]; })
	      .attr("cy", function(d) { return d[1]; });
	}



	function pathToAbsolute(relativePath) {
	  var pattern = /([mlv ])\s*(-?\d*\.?\d+)\s*,\s*(-?\d*\.?\d+)/ig,
	      coords = [];

	  var start_x;
	  var start_y;

	  relativePath.replace(pattern, function (match, command, x, y) {
	    var prev;

	    x = parseFloat(x);
	    y = parseFloat(y);

	    if(coords.length === 0 || command.toUpperCase() === command) {
	      coords.push([x, y]);
	      start_x = x;
	      start_y = y;
	    } else {
	      prev = coords[coords.length-1];
	      coords.push([x + prev[0], y + prev[1]]);
	    }
	  });

	  coords.push([start_x, start_y]);

	  return coords;
	}

	</script>
</body>

</html>